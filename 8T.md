# 8. گراف با دور یا بی دور

## خواسته سوال

یک گراف جهت‌دار با `n` رأس و `m` یال اولیه داریم. سپس `q` کوئری داریم که در هر کوئری یکی از عملیات زیر انجام می‌شود:

- `+ u v` افزودن یال از `u` به `v`
- `- u v` حذف یال از `u` به `v`

پس از هر کوئری بررسی می شود که آیا گراف بدون دور (DAG) است یا نه. اگر هست:

`Yes` چاپ می شود

سپس یک ترتیب توپولوژیک معتبر را در همان خط چاپ می شود.

در غیر این صورت:

فقط `No` چاپ می شود.

## راه حل

برای هر کوئری، ابتدا تغییرات را روی گراف اعمال می‌کنیم. سپس DFS را از تمام رئوس انجام می‌دهیم. در هنگام خروج از هر رأس $v$ آن را به لیست ترتیب توپولوژیک اضافه می‌کنیم.

هم‌زمان، بررسی می‌کنیم که تمام یال‌های برگشتی از $v$ (در گراف معکوس) به رئوسی اشاره نکنند که قبلاً از آن‌ها خارج شده‌ایم. اگر چنین یالی باشد، به معنی وجود یک دور است.

اگر در انتهای DFS هیچ دوری شناسایی نشد، گراف یک DAG است و ترتیب توپولوژیک به‌دست‌آمده معتبر است.

## پیچیدگی زمانی و حافظه

**پیچیدگی زمانی:**

  $$O(q \cdot (n + m))$$

برای هر کوئری DFS کامل روی گراف انجام می‌شود.

**پیچیدگی حافظه:**

  $$O(n + m)$$

برای نگهداری گراف و وضعیت بازدید از رئوس.
